{% extends "base.html" %}
{% block title %}Salary Sheet Edit{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}
{% block content %}
<!-- Header -->
<div class="container-fluid" style="background-color: #ffffff;">
    <div class="wrapper">
        <div class="main">
            <main class="content">
                <div class="container-fluid p-1">
                    <div class="row">
                        <div class="col-lg-6 col-sm-12 mt-2">
                            <ul class="nav justify-content-start">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" href="#">
                                        <h5 style="color: black"><b>Salary Sheet</b></h5>
                                    </a>
                                </li>


                                <li>   <div class="form-outline  text-start ">
                     {% set month_dict = {'001': 'January', '002': 'February', '003': 'March', '004': 'April',
                    '005': 'May', '006': 'June', '007': 'July', '008': 'August', '009': 'September', '0010': 'October',
                    '0011': 'November', '0012': 'December'} %}
                    <input type="text" class="form-control" id="forminput" placeholder="{{ month_dict[id[3:]] }}"readonly>
                </div></li>
                            </ul>
                        </div>
                          <div class="col end-0 ">
                <ul class="nav justify-content-end mt-2">

                    <li class="nav-item me-2">
                        <div class="dropdown">
                            <a href="{{url_for('salary_sheet_view', username=username, salid=id)}}">
                                <button class="btn border-1 btn-secondary " type="button" aria-haspopup="true"
                                        aria-expanded="false">
                                    Back
                                </button>
                            </a>

                        </div>
                    </li>
                </ul>
            </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>
<div class="container-fluid" style="background-color: #F4F5F7;">
    <div class="container-fluid p-3">


        <table class="table table-bordered" style="border: 2px solid black !important;">

            <!-- Table Heading  -->
            <thead class="text-center center align-baseline">
            <tr class="border-bottom" scope="col" style="border: 2px solid !important;">
                <th scope="col" rowspan="2" class="align-middle" style="background-color: #DFE1E6;">Employee Name</th>
                <th scope="col" rowspan="2" class="align-middle" style="background-color: #DFE1E6;">Working Hours</th>
                <th scope="col rwo-2" rowspan="2" class="align-middle" style="background-color: #DFE1E6;"> LWP</th>
                <th scope="col" colspan="8" class="align-middle" style="background-color: #DCFDD9;">Earning</th>
                <th scope="row col" rowspan="2" class="align-middle" style="background-color: #DFE1E6;">Gross Salary
                </th>
                <th scope="col-6" colspan="6" class="align-middle" style="background-color: #FDD9DB;">Deduction</th>
                <th scope="row-2 col" rowspan="2" class="align-middle" style="background-color: #DFE1E6;">Net Payable
                </th>
                <th rowspan="2" class="align-middle" style="background-color: #DFE1E6;"></th>
            </tr>
            <tr class="border-bottom" style="border:2px solid black !important;">
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Basic</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">HRA</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">DA</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Other Allowance</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Incentive</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Arrears</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Outstanding Adjustments</th>
                <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Statutory Bonus</th>
                <th scope="col" class="align-middle" style="background-color: #FDD9DB;">EPFO</th>
                <th scope="col" class="align-middle" style="background-color: #FDD9DB;">PT</th>
                <th scope="col" class="align-middle" style="background-color: #FDD9DB;">TDS</th>
                <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Leave Deduction</th>
                <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Other Deduction</th>
                <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Outstanding Adjustment</th>
            </tr>
            </thead>


            <tbody style="background-color: #ffffff;">
            <tr class="ttr text-center">
            <form action="{{url_for('salary_sheet_edit_', username=username, empid=data[id]['userID'],salid=id )}}" method="POST">
                <label name="" ></label>
                <th scope="col">{{ data[id]["employeeName"] }}</th>
                <th scope="col">{{ data[id]["WrkHrs"] }}</th>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["lwp"] }}' name="lwp" id="lwp" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["basic"] }}' name="basic" id="basic"readonly onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center"  name="hra" id="hra" value='{{ data[id]["hra"] }}'readonly onkeypress="onlyNumber(event)"></td>
                <th scope="col"><input type="text" class="form-control text-center  " value='{{ data[id]["da"] }}' name="da" id="da"  readonly onkeypress="onlyNumber(event)"></th>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["otherAllowance"] }}' id="otherAllowance" name="otherAllowance" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["incentive"] }}' id="incentive" name="incentive" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["arrears"] }}' id="arrears" name="arrears" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["grsOutstandingAdjustment"] }}' id="grsOutstandingAdjustment" name="grsOutstandingAdjustment" onkeypress="onlyNumber(event)">
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["statutoryBonus"] }}' id="statutoryBonus" name="statutoryBonus" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["grossSalary"] }}' id="grossSalary" name="grossSalary" readonly onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["epfo"] }}' id="epfo" name="epfo" readonly onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["pt"] }}' id="pt" name="pt" readonly onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["tds"] }}' id="tds" name="tds" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["leaveDeduction"] }}' id="leaveDeduction" name="leaveDeduction" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["otherDeduction"] }}' id="otherDeduction" name="otherDeduction" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["dedOutstandingAdjustment"] }}' id="dedOutstandingAdjustment" name="dedOutstandingAdjustment" onkeypress="onlyNumber(event)"></td>
                <td scope="col"><input type="text" class="form-control text-center" value='{{ data[id]["netSalary"] }}' id="netSalary" name="netSalary"  readonly onkeypress="onlyNumber(event)"></td>
                <td>
                        <button class="btn border-1 btn-secondary"aria-haspopup="true" type="submit"
                                aria-expanded="false"
                                style="color:#2F3990; border-color:#2F3990; background-color: #FFFFFF">
                            Update
                        </button>
                </td>
            </form>
            </tr>
            </tbody>
        </table>

    </div>
</div>


<script>
    // Do all your JavaScript in a separate JavaScript section
    var basic = document.getElementById("basic");
    var hra = document.getElementById("hra");
    var lwp = document.getElementById("lwp");
    var da = document.getElementById("da");
    var otherAllowance = document.getElementById("otherAllowance");
    var incentive = document.getElementById("incentive");
    var arrears = document.getElementById("arrears");
    var grsOutstandingAdjustment = document.getElementById("grsOutstandingAdjustment");
    var statutoryBonus = document.getElementById("statutoryBonus");
    var grossSalary = document.getElementById("grossSalary");
    var epfo = document.getElementById("epfo");
    var pt = document.getElementById("pt");
    var tds = document.getElementById("tds");
    var leaveDeduction = document.getElementById("leaveDeduction");
    var otherDeduction = document.getElementById("otherDeduction");
    var dedOutstandingAdjustment = document.getElementById("dedOutstandingAdjustment");
    var netSalary = document.getElementById("netSalary");

    var inputs = Array.prototype.slice.call(document.querySelectorAll("td > input"));

    inputs.forEach(function(input) {
        input.addEventListener("keyup", function() {
            // Function to handle blank or none values
            function handleEmptyValue(value) {
                return value === "" || value === null || value === undefined ? 0 : parseFloat(value);
            }

            var lwpValue = handleEmptyValue(lwp.value);
            var basicValue = handleEmptyValue(basic.value);
            var hraValue = handleEmptyValue(hra.value);
            var daValue = handleEmptyValue(da.value);
            var otherAllowanceValue = handleEmptyValue(otherAllowance.value);
            var incentiveValue = handleEmptyValue(incentive.value);
            var arrearsValue = handleEmptyValue(arrears.value);
            var grsOutstandingAdjustmentValue = handleEmptyValue(grsOutstandingAdjustment.value);
            var statutoryBonusValue = handleEmptyValue(statutoryBonus.value);
            var epfoValue = handleEmptyValue(epfo.value);
            var ptValue = handleEmptyValue(pt.value);
            var tdsValue = handleEmptyValue(tds.value);
            var leaveDeductionValue = handleEmptyValue(leaveDeduction.value);
            var otherDeductionValue = handleEmptyValue(otherDeduction.value);
            var dedOutstandingAdjustmentValue = handleEmptyValue(dedOutstandingAdjustment.value);

            hra.value = (hraValue);
            da.value = (daValue);
            grossSalary.value = (
                basicValue +
                hraValue +
                daValue +
                otherAllowanceValue +
                incentiveValue +
                arrearsValue +
                grsOutstandingAdjustmentValue +
                statutoryBonusValue
            ).toFixed(2);
            leaveDeduction.value = (
                lwpValue * ((basicValue + hraValue + daValue + otherAllowanceValue) / {{working_days}}) * 1
            ).toFixed(2);
            netSalary.value = (
                grossSalary.value -
                epfoValue -
                ptValue -
                tdsValue -
                leaveDeductionValue -
                otherDeductionValue -
                dedOutstandingAdjustmentValue
            ).toFixed(2);
        });
    });
</script>



<!--Script for only number input -->
<script>
    const onlyNumber = (event) => {
        let keyCode = event.keyCode ? event.keyCode : event.which;
        if ((keyCode < 48 || keyCode > 57) && keyCode !== 46) {
            event.preventDefault();
        }
    };
</script>



{% endblock %}