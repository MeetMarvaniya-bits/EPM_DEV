{% extends "base.html" %}
{% block title %}Salary{% endblock %}
{% block head %}
{{ super() }}
<style>
    .wrapper {
  overflow-x:scroll;
  width:100%;
}
table {
  table-layout: fixed;
  width: 100%;
  border-collapse: collapse;
  background: white;
}
tr {
  border-top: 1px solid #000000;
}
td, th {
  vertical-align: top;
  text-align: center;
  width:500px;
  padding: 5px;
}
.fix {
  position:sticky;
  background: white;
}
.fix:first-child {
  left:-5px;
  width:150px;
  background: white;
}
.fix:second-child {
  left:-5px;
  width:180px;
  background: white;
}
.third-child {
  position:sticky;
  left:140px;
  width:150px;
  background: white;
}
.second-last-child {
  position:sticky;
  right:92px;
  width:150px;
  background: white;
}
.fix:last-child {
  right:-5px;
  width:100px;
  background: white;
}

.other-child {
  width:150px;
}

.earning-child {
  width:1500px;
}
.deduction-child {
  width:1000px;
}
.tableFixHead {
        /* make the table scrollable if height is more than 200 px  */
        height: 630px; /* gives an initial height of 200px to the table */
      }
      table {
        border-collapse: collapse; /* make the table borders collapse to each other */
        width: 100%;
      }
      th,
      td {
        padding: 8px 16px;
        border: 1px solid #ccc;
      }
      th {
        background: #eee;
      }

.tableFixHead tbody tr {
  position: sticky;
  top: 100px; /* Adjust the left position based on your first column width */
  background-color: #FFFFFF;
}

</style>
{% endblock %}
{% block content %}

<!-- Header -->
<div class="container-fluid" style="background-color: #ffffff;">
    <div class="main">
        <main class="content">
            <div class="container-fluid p-1">
                <div class="row">
                    <div class="col-lg-4 col-sm-12 mt-2">
                        <ul class="nav justify-content-start">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">
                                    <h5><b>Salary Sheet</b></h5>
                                </a>
                            </li>
                            <li>
                                <div class="form-outline text-start">
                                    {% set months_dict = {'001': 'January', '002': 'February', '003': 'March', '004':
                                    'April', '005': 'May',
                                    '006': 'June', '007': 'July', '008': 'August', '009': 'September', '0010':
                                    'October', '0011':
                                    'November',
                                    '0012': 'December'} %}

                                    <select id="monthDropdown" class="form-control" style="width: 13rem;">
                                        {% set months_dict = {'001': 'January', '002': 'February', '003': 'March',
                                        '004': 'April', '005': 'May', '006': 'June', '007': 'July', '008': 'August',
                                        '009': 'September', '0010': 'October', '0011': 'November', '0012': 'December'}
                                        %}
                                        {% for month_dict in months_dict %}
                                        {% if months_dict[month_dict] in months %}
                                        {% set month_value = 'sal' + month_dict+'_'+ salid.split('_')[1] %}
                                        <option value="{{ month_value }}"
                                                onclick="window.location.href='url_for(salary_sheet_view,username,month_id)'"
                                                {% if months_dict[month_dict]== month_name %} selected {% endif %}>{{
                                            months_dict[month_dict] }}
                                        </option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>


                                    <script>
                    // Set the default selected option
                    var defaultMonth = "{{month_name}}"; // Specify the default month here
                  
                    // Find the corresponding option and set it as selected
                    var dropdown = document.getElementById("monthDropdown");
                    for (var i = 0; i < dropdown.options.length; i++) {
                      if (dropdown.options[i].text === defaultMonth) {
                        dropdown.selectedIndex = i;
                        break;
                      }
                    }

                                    </script>
                                    <script>
                    // Handle the selection change event
                    document.getElementById("monthDropdown").addEventListener('change', function() {
                      var selectedOption = this.options[this.selectedIndex];
                      var selectedUrl = selectedOption.value;
                      
                      // Redirect to the selected URL
                      window.location.href = selectedUrl;
                    });

                                    </script>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="col end-0">
                        <ul class="nav justify-content-end  mt-2">
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <button id="edit-row-button" class="btn border-1 btn-secondary" type="button">
                                        Edit Rows
                                    </button>
                                </div>
                            </li>
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <!-- Button trigger modal -->
                                    <button id="uploadButton" class="btn border-1 btn-secondary" type="button">
                                        Import Excel Sheet
                                    </button>
                                </div>
                            </li>
                            <!-- HOLIDAYS MODAL -->
                            <div class="modal" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog vh-100  modal-dialog-scrollable justify-content-end p-0 me-0 mt-0 mb-0">
                                    <div class="modal-content vh-100">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="managmonthdays">Manage Month Days</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="container">
                                            <form action="{{url_for('salary_sheet_view', username=username, salid=salid)}}"
                                                  method="POST"
                                                  id="monthdata" class="pb-4">

                                                <h6 class="modal-title pt-4" id="addholidays">ADD Holidays</h6>

                                                <div class="modal-body inline">

                                                    <input type="date" name="date" id="date" value="" required
                                                           class="form-control-sm pe-3">

                                                    <input type="text" name="description" id="description" value=""
                                                           placeholder="Description"
                                                           class="form-control-sm" required>
                                                </div>
                                                <div class="modal-footer justify-content-center">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close
                                                    </button>
                                                    <button type="submit" value="submit"
                                                            class="btn btn-primary">ADD
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <hr>
                                        <div class="container">
                                            <h6 class="modal-title pb-4" id="exampleModalLabel">Holidays</h6>
                                            <table>
                                                {% for month_str, month_data in holidays.items(): %}
                                                <tr class="p-2">
                                                    <th colspan="2">
                                                        <b class="ps-2 pt-4"> {{month_str}} </b>
                                                    </th>
                                                </tr>
                                                {% for date_str, value in month_data.items():%}
                                                <tr>
                                                    <td col=1>
                                                        <b class="ps-5"> {{date_str }} </b>
                                                    </td>
                                                    <td col=1>
                                                        <i class="ps-5"> {{value }} </i>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                {% endfor %}
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <!-- Button trigger modal -->
                                    <button class="btn border-1 btn-secondary " type="button"
                                            data-bs-toggle="modal" data-bs-target="#exampleModal3" aria-haspopup="true"
                                            aria-expanded="false">
                                        Holidays
                                    </button>
                                </div>
                            </li>
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <label style="    width: 100px;
                           height: 40px;
                           border-radius: 10px;
                           text-align: center;
                           padding-top: 9px;
                           color: white;
                           font-weight: bold;
                          " id="salary_status">

                                    </label>
                                </div>
                            </li>
                            {% if salary_status=="None" or salary_status=="Pending" %}
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <a href="{{url_for('set_status', username=username, salid=salid, status='Inreview')}}">
                                        <button class="btn border-1 btn-secondary " id="btn_1" type="button"
                                                aria-haspopup="true"
                                                aria-expanded="false">
                                            Submit for Approval
                                        </button>
                                    </a>
                                </div>
                            </li>
                            {% endif %}
                            {% if salary_status=="Inreview" and username=='Admin' %}
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <a href="{{url_for('set_status', username=username, salid=salid, status='Approved')}}">
                                        <button class="btn border-1 btn-secondary " id="btn_2 " type="button"
                                                aria-haspopup="true"
                                                aria-expanded="false">
                                            Accept
                                        </button>
                                    </a>
                                </div>
                            </li>
                            {% endif %}
                            {% if salary_status=="Inreview" and username=='Admin' %}
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <a href="{{url_for('set_status', username=username, salid=salid, status='Pending')}}">
                                        <button class="btn border-1 btn-secondary " id="btn_3 " type="button"
                                                aria-haspopup="true"
                                                aria-expanded="false">
                                            Decline
                                        </button>
                                    </a>
                                </div>
                            </li>
                            {% endif %}
                            {% if salary_status=="Approved" and username=='Admin' %}
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <a href="{{url_for('set_status', username=username, salid=salid, status='Paid')}}">
                                        <button class="btn border-1 btn-secondary " id=" " type="button"
                                                aria-haspopup="true"
                                                aria-expanded="false">
                                            Paid
                                        </button>
                                    </a>
                                </div>
                            </li>
                            {% endif %}
                            {% if salary_status=='Paid' %}
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <a href="{{url_for('pdf_all', username=username, salid=salid)}}">
                                        <button class="btn border-1 btn-secondary " type="button" aria-haspopup="true"
                                                id="btn_4"
                                                aria-expanded="false">
                                            Download All
                                        </button>
                                    </a>
                                </div>
                            </li>
                            {% endif %}
                            {% if salary_status=='Paid' or salary_status=='Approved' %}
                            <li class="nav-item me-2">
                                <div class="dropdown">

                                    <button class="btn border-1 btn-secondary " type="button" aria-haspopup="true"
                                            data-bs-toggle="modal" data-bs-target="#exampleModal1" id="btn_5"
                                            aria-expanded="false">
                                        Generate Excelsheet
                                    </button>

                                </div>
                            </li>
                            {% endif %}
                            {% if salary_status=='Paid' %}
                            <li class="nav-item me-2">
                                <div class="dropdown">
                                    <a href="{{url_for('send_employee_salaryslip', username=username, salid=salid)}}">
                                        <button class="btn border-1 btn-secondary " type="button" aria-haspopup="true"
                                                aria-expanded="false">
                                            Send Email
                                        </button>
                                    </a>
                                </div>
                            </li>
                            {% endif %}

                            <li class="nav-item me-2">
                                <div class=>
                                    <input type="text" id="searchInput" class="form-control"
                                           placeholder="Search for files..."
                                           onkeyup="checkInput()">
                                </div>
                            </li>
                            <li>
                                <button onclick="searchTable()" class="btn border-1 btn-secondary ">Search</button>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Display Data  -->
<div class="container-fluid" style="background-color: #F4F5F7;">
    <div class="container-fluid p-3">
        <div class="pt-3">
            <p class="p-2 ps-5  error">
                {% for key, value in moath_data.items() %}
                <b class="pe-4">{{key}} : {{value}} </b>
                {% endfor %}
                <!-- <a href="#">Click</a> -->
            </p>
        </div>
        <!-- Employees Salary Data -->
        <div class="table-scroll" style="overflow-x: auto;">
            <div class="wrapper">
                <div class="tableFixHead">
                    <table id="myTable" class="table table-bordered table-hover"
                           style="border: 2px solid black !important;">
                        <!-- Table Header  -->
                        <!--                <thead class="text-center center align-baseline" style="position: sticky !important; top: -5px !important;">-->
                        <thead class="text-center" style="position: sticky; top: 0px;">
                        <tr class="border-bottom center align-baseline"
                            style="border: 2px solid !important;  background-color: #FFFFFF;">
                            <th scope="col rwo-2" rowspan="2" class="fix align-middle"
                                style="background-color: #DFE1E6;">Employee
                                Name
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="third-child align-middle"
                                style="background-color: #DFE1E6;">Working Hours
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="other-child align-middle"
                                style="background-color: #DFE1E6;">LWP
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="other-child align-middle"
                                style="background-color: #DFE1E6;">Total Leaves
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="other-child align-middle"
                                style="background-color: #DFE1E6;">Overtime Hours
                            </th>
                            <th scope="col" colspan="9" class="earning-child align-middle"
                                style="background-color: #DCFDD9;">Earning
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="other-child align-middle"
                                style="background-color: #DFE1E6;">Total Salary
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="other-child align-middle"
                                style="background-color: #DFE1E6;">Gross Salary
                            </th>
                            <th scope="col-6" colspan="7" class="deduction-child align-middle"
                                style="background-color: #FDD9DB;">Deduction
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="second-last-child align-middle"
                                style="background-color: #DFE1E6;">Net
                                Payable
                            </th>
                            <th scope="col rwo-2" rowspan="2" class="fix last-child align-middle"
                                style="background-color: #DFE1E6;"></th>
                        </tr>
                        <tr class="border-bottom center align-baseline" style="border:2px solid black !important;">
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Basic</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">HRA</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">DA</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Other Allowance</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Incentive</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Arrears</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Outstanding
                                Adjustments
                            </th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Statutory Bonus</th>
                            <th scope="col" class="align-middle" style="background-color: #DCFDD9;">Overtime Amount</th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">EPFO</th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">PT</th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">TDS</th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Leave Deduction</th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Other Deduction</th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Outstanding
                                Adjustment
                            </th>
                            <th scope="col" class="align-middle" style="background-color: #FDD9DB;">Total Deduction</th>
                        </tr>
                        </thead>

                        <!-- Salary data  -->
                        <tbody style="background-color:#ffffff; overflow:hidden;" class="text-center">
                        {% for i in data%}

                        <tr class="border-bottom" style="border:2px solid black !important;">
                            <td scope="col" class="fix second-child">{{data[i]['employeeName']}}</td>
                            <td scope="col" class="fix third-child" style="background-color: #FFFFFF;">
                                {{data[i]['WrkHrs']}}
                            </td>
                            <td scope="col">{{ data[i]['lwp'] }}</td>
                            <td scope="col">{{ data[i]['totalLeave'] }}</td>
                            <td scope="col">{{ data[i]['OT'] }}</td>
                            <td scope="col">{{data[i]['basic']}}</td>
                            <td scope="col">{{data[i]['hra']}}</td>
                            <td scope="col">{{data[i]['da']}}</td>
                            <td scope="col">{{data[i]['otherAllowance']}}</td>
                            <td scope="col">{{data[i]['incentive']}}</td>
                            <td scope="col">{{data[i]['arrears']}}</td>
                            <td scope="col">{{data[i]['grsOutstandingAdjustment']}}</td>
                            <td scope="col">{{data[i]['statutoryBonus']}}</td>
                            <td scope="col">{{data[i]['overtimeAmount']}}</td>
                            <td scope="col">{{data[i]['totalSalary']}}</td>
                            <td scope="col">{{data[i]['grossSalary']}}</td>
                            <td scope="col">{{data[i]['epfo']}}</td>
                            <td scope="col">{{data[i]['pt']}}</td>
                            <td scope="col">{{data[i]['tds']}}</td>
                            <td scope="col">{{data[i]['leaveDeduction']}}</td>
                            <td scope="col">{{data[i]['otherDeduction']}}</td>
                            <td scope="col">{{data[i]['dedOutstandingAdjustment']}}</td>
                            <td scope="col">{{data[i]['totalDeduction']}}</td>
                            <td scope="col" class="second-last-child" style="background-color: #FFFFFF;">
                                {{data[i]['netSalary']}}
                            </td>

                            <!-- Edit Button  -->
                            {% if salary_status=='Paid' or salary_status=='Approved'%}
                            <td scope="col" class="fix last-child" style="background-color: #FFFFFF;">
                                <a href="{{url_for('salary_sheet_edit_', username=username,empid=data[i]['userID'],salid=salid)}}" >
                                    <button class="btn border-1 btn-secondary" type="button" aria-haspopup="true"
                                            aria-expanded="false"
                                            style="color:#2F3990; border-color:#2F3990; background-color: #FFFFFF">
                                        Edit
                                    </button>
                                </a>
                            </td>
                            {% else %}
                            <td scope="col" class="fix last-child" style="background-color: #FFFFFF;">
                                <a href="{{url_for('salary_sheet_edit_', username=username,empid=data[i]['userID'],salid=salid)}}">
                                    <button class="btn border-1 btn-secondary" type="button" aria-haspopup="true"
                                            aria-expanded="false"
                                            style="color:#2F3990; border-color:#2F3990; background-color: #FFFFFF">
                                        Edit
                                    </button>
                                </a>
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor%}
                        </tbody>
                        <!-- Sticky row for column totals -->
                        <tfoot class="text-center" style="position: sticky; bottom: -5px;">
                        <tr class="border-bottom" style="border:2px solid black !important;">
                            <th class="fix align-middle" style="background-color: #FFFFFF;"></th>
                            <th class="third-child align-middle" style="background-color: #FFFFFF;"></th>
                            <th class="other-child align-middle" style="background-color: #FFFFFF;"></th>
                            <th style="background-color: #FFFFFF;"></th>
                            <th style="background-color: #FFFFFF;"></th>
                            <th id="totalBasic" style="background-color: #FFFFFF;"></th>
                            <th id="totalHra" style="background-color: #FFFFFF;"></th>
                            <th id="totalDa" style="background-color: #FFFFFF;"></th>
                            <th id="totalOtherAllowance" style="background-color: #FFFFFF;"></th>
                            <th id="totalIncentive" style="background-color: #FFFFFF;"></th>
                            <th id="totalArrears" style="background-color: #FFFFFF;"></th>
                            <th id="totalGrsOutstandingAdjustment" style="background-color: #FFFFFF;"></th>
                            <th id="totalStatutoryBonus" style="background-color: #FFFFFF;"></th>
                            <th id="totalOvertimeAmount" style="background-color: #FFFFFF;"></th>
                            <th id="totalTotalSalary" style="background-color: #FFFFFF;"></th>
                            <th id="totalGrossSalary" style="background-color: #FFFFFF;"></th>
                            <th id="totalEpfo" style="background-color: #FFFFFF;"></th>
                            <th id="totalPt" style="background-color: #FFFFFF;"></th>
                            <th id="totalTds" style="background-color: #FFFFFF;"></th>
                            <th id="totalLeaveDeduction" style="background-color: #FFFFFF;"></th>
                            <th id="totalOtherDeduction" style="background-color: #FFFFFF;"></th>
                            <th id="totalDedOutstandingAdjustment" style="background-color: #FFFFFF;"></th>
                            <th id="totalTotalDeduction" style="background-color: #FFFFFF;"></th>
                            <th class="second-last-child" style="background-color: #FFFFFF;" id="totalNetSalary"
                                style="background-color: #FFFFFF;"></th>
                            <th class="fix last-child align-middle" style="background-color: #FFFFFF;"></th>
                            <!-- Edit Button column -->
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal " id="exampleModal1" tabindex="-1"
                         aria-labelledby="exampleModalLabel1" aria-hidden="true">
                        <div class="modal-dialog vh-100  modal-dialog-scrollable justify-content-end p-0 me-0 mt-0 mb-0">
                            <div class="modal-content vh-100">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel1"> Excel-sheet Format </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                </div>
                                <div class="container">

                                <form action="{{url_for('salary_sheet_view', username=username,salid=salid)}}"
                                      method="POST"
                                      id="salarydata">
                                    <div class="modal-body inline">
                                        <label for="field1" class="col-3 form-control-sm">Field-1</label>
                                        <select name="field1" id="field1" class="form-control-sm"
                                                onchange="removeSelectedOption(this, ['field2','field3', 'field4', 'field5'] )">
                                            <option > Choose Option</option>
                                            <option >Bank Name</option>
                                            <option >Employee Name</option>
                                            <option >IFSC Code</option>
                                            <option >Account Number</option>
                                            <option >Salary</option>
                                        </select>
                                    </div>
                                    <div class="modal-body inline">
                                        <label for="field2" class="col-3 form-control-sm">Field-2</label>
                                        <select name="field2" id="field2"class="form-control-sm"
                                                onchange="removeSelectedOption(this, ['field1','field3', 'field4', 'field5'] )">
                                            <option> Choose Option</option>
                                            <option>Bank Name</option>
                                            <option>Employee Name</option>
                                            <option>IFSC Code</option>
                                            <option>Account Number</option>
                                            <option>Salary</option>
                                        </select>
                                    </div>
                                    <div class="modal-body inline">
                                        <label for="field3" class="col-3 form-control-sm">Field-3</label>
                                        <select name="field3" id="field3"class="form-control-sm"
                                                onchange="removeSelectedOption(this, ['field2','field1', 'field4', 'field5'] )">
                                            <option> Choose Option</option>
                                            <option>Bank Name</option>
                                            <option>Employee Name</option>
                                            <option>IFSC Code</option>
                                            <option>Account Number</option>
                                            <option>Salary</option>
                                        </select>
                                    </div>
                                    <div class="modal-body inline">
                                        <label for="field4" class="col-3 form-control-sm">Field-4</label>
                                        <select name="field4" id="field4"class="form-control-sm"
                                                onchange="removeSelectedOption(this, ['field2','field3', 'field1', 'field5'] )">
                                            <option> Choose Option</option>
                                            <option>Bank Name</option>
                                            <option>Employee Name</option>
                                            <option>IFSC Code</option>
                                            <option>Account Number</option>
                                            <option>Salary</option>
                                        </select>
                                    </div>
                                    <div class="modal-body inline">
                                        <label for="field5" class="col-3 form-control-sm">Field-5</label>
                                        <select name="field5" id="field5"class="form-control-sm"
                                                onchange="removeSelectedOption(this, ['field2','field3', 'field1', 'field4'] )">
                                            <option value=""> Choose Option</option>
                                            <option>Bank Name</option>
                                            <option>Employee Name</option>
                                            <option>IFSC Code</option>
                                            <option>Account Number</option>
                                            <option>Salary</option>
                                        </select>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary form-control-sm"
                                                data-bs-dismiss="modal">Close
                                        </button>
                                        <button type="submit" value="submit" class="btn btn-primary">Generate
                                        </button>
                                    </div>
                                </form>

                                <div class="accordion" id="accordionExample">
                                    <!-- FORMATE FOR BOB -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingOne">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                    data-bs-target="#collapseOne" aria-expanded="true"
                                                    aria-controls="collapseOne">
                                                Excelsheet Format For BOB
                                            </button>
                                        </h2>
                                        <div id="collapseOne" class="accordion-collapse collapse show"
                                             aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                            <div class="accordion-body ms-4">
                                                <div class="row">
                                                    <lable class="col-3">Field-1</lable>
                                                    <input class="col-4  form-control-sm" readonly placeholder="Bank Name">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-2</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Employee Name">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-3</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Account Number">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-4</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="IFSC Code">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-5</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Salary">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- FORMATE FOR SBI -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingTwo">
                                            <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#collapseTwo"
                                                    aria-expanded="false" aria-controls="collapseTwo">
                                                Excelsheet Format For SBI
                                            </button>
                                        </h2>
                                        <div id="collapseTwo" class="accordion-collapse collapse"
                                             aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                            <div class="accordion-body ms-4">
                                                <div class="row">
                                                    <lable class="col-3">Field-1</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Employee Name">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-2</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Bank Name">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-3</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Account Number">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-4</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="IFSC Code">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-5</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Salary">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- FORMATE FOR ICICI -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingThree">
                                            <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#collapseThree"
                                                    aria-expanded="false" aria-controls="collapseThree">
                                                Excelsheet Format for ICICI
                                            </button>
                                        </h2>
                                        <div id="collapseThree" class="accordion-collapse collapse"
                                             aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                                            <div class="accordion-body ms-4">
                                                <div class="row">
                                                    <lable class="col-3">Field-1</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Employee Name">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-2</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Bank Name">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-3</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="IFSC Code">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-4</lable>
                                                    <input class="col-4 form-control-sm " readonly placeholder="Account Number">
                                                </div>
                                                <br>
                                                <div class="row">
                                                    <lable class="col-3">Field-5</lable>
                                                    <input class="col-4  form-control-sm" readonly placeholder="Salary">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    </div>
                            </div>
                        </div>
                    </div>

<!--Search Bar JS-->
 <script>
        function searchTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (filter === '' || txtValue.toUpperCase().startsWith(filter)) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function checkInput() {
            var input = document.getElementById("searchInput");
            if (input.value === '') {
                var table = document.getElementById("fileTable");
                var tr = table.getElementsByTagName("tr");
                for (var i = 0; i < tr.length; i++) {
                    tr[i].style.display = "";
                }
            }
        }
    </script>

<!--Calculate Total of all value in column -->
<script>
  // Calculate the total and update the footer cells
  function calculateTotal() {
    const table = document.getElementById("myTable");
    const tbody = table.getElementsByTagName("tbody")[0];
    const rows = tbody.getElementsByTagName("tr");

    let totalBasic = 0;
    let totalHra = 0;
    let totalDa = 0;
    let totalOtherAllowance = 0;
    let totalIncentive = 0;
    let totalArrears = 0;
    let totalGrsOutstandingAdjustment = 0;
    let totalStatutoryBonus = 0;
    let totalOvertimeAmount = 0;
    let totalTotalSalary = 0;
    let totalGrossSalary = 0;
    let totalEpfo = 0;
    let totalPt = 0;
    let totalTds = 0;
    let totalLeaveDeduction = 0;
    let totalOtherDeduction = 0;
    let totalDedOutstandingAdjustment = 0;
    let totalTotalDeduction = 0;
    let totalNetSalary = 0;

    for (let i = 0; i < rows.length; i++) {
      const cells = rows[i].getElementsByTagName("td");
      totalBasic += parseFloat(cells[5].textContent) || 0;
      totalHra += parseFloat(cells[6].textContent) || 0;
      totalDa += parseFloat(cells[7].textContent) || 0;
      totalOtherAllowance += parseFloat(cells[8].textContent) || 0;
      totalIncentive += parseFloat(cells[9].textContent) || 0;
      totalArrears += parseFloat(cells[10].textContent) || 0;
      totalGrsOutstandingAdjustment += parseFloat(cells[11].textContent) || 0;
      totalStatutoryBonus += parseFloat(cells[12].textContent) || 0;
      totalOvertimeAmount += parseFloat(cells[13].textContent) || 0;
      totalTotalSalary += parseFloat(cells[14].textContent) || 0;
      totalGrossSalary += parseFloat(cells[15].textContent) || 0;
      totalEpfo += parseFloat(cells[16].textContent) || 0;
      totalPt += parseFloat(cells[17].textContent) || 0;
      totalTds += parseFloat(cells[18].textContent) || 0;
      totalLeaveDeduction += parseFloat(cells[19].textContent) || 0;
      totalOtherDeduction += parseFloat(cells[20].textContent) || 0;
      totalDedOutstandingAdjustment += parseFloat(cells[21].textContent) || 0;
      totalTotalDeduction += parseFloat(cells[22].textContent) || 0;
      totalNetSalary += parseFloat(cells[23].textContent) || 0;
    }

    // Update the footer cells with the calculated totals
    document.getElementById("totalBasic").textContent = totalBasic.toFixed(2);
    document.getElementById("totalHra").textContent = totalHra.toFixed(2);
    document.getElementById("totalDa").textContent = totalDa.toFixed(2);
    document.getElementById("totalOtherAllowance").textContent = totalOtherAllowance.toFixed(2);
    document.getElementById("totalIncentive").textContent = totalIncentive.toFixed(2);
    document.getElementById("totalArrears").textContent = totalArrears.toFixed(2);
    document.getElementById("totalGrsOutstandingAdjustment").textContent = totalGrsOutstandingAdjustment.toFixed(2);
    document.getElementById("totalStatutoryBonus").textContent = totalStatutoryBonus.toFixed(2);
    document.getElementById("totalOvertimeAmount").textContent = totalOvertimeAmount.toFixed(2);
    document.getElementById("totalTotalSalary").textContent = totalTotalSalary.toFixed(2);
    document.getElementById("totalGrossSalary").textContent = totalGrossSalary.toFixed(2);
    document.getElementById("totalEpfo").textContent = totalEpfo.toFixed(2);
    document.getElementById("totalPt").textContent = totalPt.toFixed(2);
    document.getElementById("totalTds").textContent = totalTds.toFixed(2);
    document.getElementById("totalLeaveDeduction").textContent = totalLeaveDeduction.toFixed(2);
    document.getElementById("totalOtherDeduction").textContent = totalOtherDeduction.toFixed(2);
    document.getElementById("totalDedOutstandingAdjustment").textContent = totalDedOutstandingAdjustment.toFixed(2);
    document.getElementById("totalTotalDeduction").textContent = totalTotalDeduction.toFixed(2);
    document.getElementById("totalNetSalary").textContent = totalNetSalary.toFixed(2);
  }

  calculateTotal(); // Call the function to calculate the initial totals
</script>



<script>
// Get the salary status value from an input element or any other source
const salaryStatus = '{{salary_status}}'; // replace with your own value

// Get the label element
const salaryStatusLabel = document.getElementById('salary_status');

// Set the background color and text based on the salary status
if (salaryStatus === 'Paid') {
  salaryStatusLabel.style.backgroundColor = "#28C76F";
  salaryStatusLabel.textContent = 'Paid';
} else if(salaryStatus==='Pending') {
  salaryStatusLabel.style.backgroundColor = "#FF9128";
  salaryStatusLabel.textContent = 'Pending';
}
else if(salaryStatus==='Approved') {
  salaryStatusLabel.style.backgroundColor = "#7367F0";
  salaryStatusLabel.textContent = 'Approved';
}
else if(salaryStatus==='Inreview') {
  salaryStatusLabel.style.backgroundColor =  "#7367F0";
  salaryStatusLabel.textContent = 'Inreview';
}else if(salaryStatus==='None') {
  salaryStatusLabel.style.backgroundColor = '';
  salaryStatusLabel.textContent = '';
}





  function removeSelectedOption(selectElement, otherSelectIds) {
    const selectedValue = selectElement.value;
    for (let i = 0; i < otherSelectIds.length; i++) {
      const otherSelect = document.getElementById(otherSelectIds[i]);
      const options = otherSelect.options;

      for (let j = 0; j < options.length; j++) {
        if (options[j].value === selectedValue) {
          options[j].remove();
          break;
        }
      }
    }
  }

</script>

<script>
    document.getElementById("topEditButton").addEventListener("click", function() {
        // Get all the table rows
        var rows = document.querySelectorAll("table tbody tr");
        
        // Enable editing for each row
        for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].querySelectorAll("td");
            for (var j = 0; j < cells.length; j++) {
                cells[j].contentEditable = "true";
            }
        }
    });
</script>

<script>
    // Function to handle saving the edited data
    function saveEditedData() {
        // Get all the table rows
        var rows = document.querySelectorAll("table tbody tr");

        // Create an array to store the updated data
        var updatedData = [];

        // Loop through each row
        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            var cells = row.querySelectorAll("td");

            // Check if the row has been edited
            if (row.getAttribute("data-edited") === "true") {
                // Create an object to store the data for this row
                var rowData = {};

                // Loop through each cell
                for (var j = 0; j < cells.length; j++) {
                    var columnName = cells[j].getAttribute("data-column-name");
                    var cellContent = cells[j].textContent.trim();

                    // Store the column name and cell content in the rowData object
                    rowData[columnName] = cellContent;
                }

                // Add the rowData object to the updatedData array
                updatedData.push(rowData);
                
            }
        }

        console.log(updatedData)
        // Make sure there are edited rows before sending the request
        if (updatedData.length > 0) {
            // Make an AJAX request to send the updatedData to the server
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/save-edited-data", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                    console.log("Data saved successfully");
                }
            };
            xhr.send(JSON.stringify(updatedData));
        } else {
            console.log("No edited rows to save");
        }
    }

    // Add event listeners to detect changes in cells
    var cells = document.querySelectorAll("table tbody td[data-column-name]");
    for (var i = 0; i < cells.length; i++) {
        cells[i].addEventListener("input", function () {
            // Mark the row as edited
            this.closest("tr").setAttribute("data-edited", "true");
        });
    }
</script>

<script>
    // Get the edit row button element
    const editRowButton = document.getElementById('edit-row-button');

    // Extract the username and salid values from the current URL
    const urlParts = window.location.pathname.split('/');
    const username = urlParts[1];
    const salid = urlParts[3];

    // Add an event listener for the click event
    editRowButton.addEventListener('click', () => {
        // Redirect the user to the desired URL
        window.location.href = `/${username}/salarysheeteditall/${salid}`;
    });
</script>



<script>
document.addEventListener('DOMContentLoaded', () => {
    const uploadButton = document.getElementById('uploadButton');

    uploadButton.addEventListener('click', () => {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';

        fileInput.addEventListener('change', () => {
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            fetch('/{{username}}/upload/{{salid}}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Handle the response from the server
                console.log(data);
            })
            .catch(error => {
                // Handle any errors
                console.error(error);
            });
        });

        fileInput.click();
    });
});
</script>




{% endblock %}